
{% extends "home.html" %}
{% load static %}
{% load bootstrap4 %}
{% block test %}
<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#t1').hide();
        $('#id_room').hide();
        $('#room-select').hide();

        $('#id_start_time').change(function () {
            var room = $('#id_room').val();
            var date = $('#id_start_time').val();
            $('#id_room').show()
        $('#room-select').show();

            $.ajax({
            url:"{% url 'checkReservations' %}",
            data:{
                'room': room,
                'date' : date
            },
            dataType:   'json',
            success: function (data) {

                

                var MyTable = document.getElementById('t1');
                var rows = MyTable.getElementsByTagName('tr');

                for (var key in data) {
                    let result = data[key].map(a => a.block);
                    var x = document.getElementById("t1").getElementsByTagName("td");
                    if (result.length == 0) {
                        for (i = 0; i < 7; i++) {
                            x[i].style.backgroundColor = "green";
                        }
                    } else {
                        result.forEach(createTable);
                    }


                    function createTable(value, index, array) {
                        console.log(value)
                        var x = document.getElementById("t1").getElementsByTagName("td");
                        for (i = 0; i < 7; i++) {
                            if (i == value) {
                                x[value - 1].style.backgroundColor = "red";
                            } else {
                                x[i].style.backgroundColor = "green";
                            }
                        }
                    }
                }
            }
          });

        });

        $('#room-select').change(function () {
          var room = $(this).val();
          var date = $('#id_start_time').val();

          $.ajax({
            url:"{% url 'checkReservations' %}",
            data:{
                'room': room,
                'date' : date
            },
            dataType:   'json',
            success: function (data) {

                $('#t1').show();

                var MyTable = document.getElementById('t1');
                var rows = MyTable.getElementsByTagName('tr');

                for (var key in data) {
                    let result = data[key].map(a => a.block);
                    var x = document.getElementById("t1").getElementsByTagName("td");
                    if (result.length == 0) {
                        for (i = 0; i < 7; i++) {
                            x[i].style.backgroundColor = "green";
                        }
                    } else {
                        result.forEach(createTable);
                    }


                    function createTable(value, index, array) {
                        console.log(value)
                        var x = document.getElementById("t1").getElementsByTagName("td");
                        for (i = 0; i < 7; i++) {
                            if (i == value) {
                                x[value - 1].style.backgroundColor = "red";
                            } else {
                                x[i].style.backgroundColor = "green";
                            }
                        }
                    }
                }
            }
          });
        });
    })
</script>
    <link rel="stylesheet" href="{% static 'css/tables.css' %}">

    <container>

    <a class="btn btn-primary" href="{% url 'learning_spaces_reservation_list' %}">
    Reservierungsübersicht
    </a>


        <form method="POST", class="reservationForm" id="reservationForm">
        {% csrf_token %}
            <div class="form-group row">
                {{ form.errors }}

                <div class="fieldWrapper">
                <label for="{{ form.start_time.id_for_label }}">Für welches Datum möchten Sie einen Space reservieren?:</label>

                {{ form.start_time }}
                </div>
                    <div class="fieldWrapper">
                        <label id="id_room" for="{{ form.room.id_for_label }}">Welchen Space möchten Sie reservieren?:</label>

                        <select id= "room-select" name="room">
                        {% for element in some_data %}
                            <option value={{ element.size }}>{{ element.size }}</option>
                        {% endfor %}
                        </select>


                    </div>
            </div>
         <table id="t1" class="table" >
            <tr>
                <td style="background-color: green; text-align: center"> <button type="submit" name="save_block1" value="Save&Home">Block 1</button></td>
                <td style="background-color: green; text-align: center"> <a href="#"> Block 2</a></td>
                <td style="background-color: green; text-align: center"> <a href="#"> Block 3</a></td>
                <td style="background-color: green; text-align: center"> <a href="#"> Block 4</a></td>
                <td style="background-color: green; text-align: center"> <a href="#"> Block 5</a></td>
                <td style="background-color: green; text-align: center"> <a href="#"> Block 6</a></td>
                <td style="background-color: green; text-align: center"> <a href="#"> Block 7</a></td>
            </tr>
        </table>
            <input type="submit" value="Save" class="btn btn-primary">

        </form>
</container>
{% endblock %}